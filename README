KOUAME_CHRISTIAN_GeoDataAnalyst – Pipeline & API
================================================

Ce depot contient les scripts de preparation de donnees, un pipeline d'orchestration (`main_pipeline.py`) et une API FastAPI (`api.py`) qui expose les fichiers pre-rendus pour le dashboard Next.js.

Prérequis
---------
- Python 3.12
- Environnement virtuel déjà présent dans `venv/`
- Dépendances listées dans `requirements.txt` (FastAPI, Pandas, GeoPandas, etc.)

Installation
------------
```bash
source venv/bin/activate
pip install -r requirements.txt
```

Démarrage du pipeline
---------------------
Relance tout le flux (scripts 1 → 13, exports `display-data/`) avec:
```bash
source venv/bin/activate
python main_pipeline.py
```
Les JSON generes se trouvent dans `display-data/` une fois le pipeline termine.

Démarrage du serveur
--------------------
Toujours depuis la racine du projet (ce dossier) :
```bash
source venv/bin/activate
uvicorn api:app --reload --port 8000
```
Le serveur est alors accessible sur `http://localhost:8000` et autorise les requêtes CORS provenant de `http://localhost:3000`.

Endpoints principaux
--------------------
- `GET /` : message de bienvenue + version.
- `GET /status` : liste des dossiers surveilles + fichiers disponibles dans `display-data/`.
- `GET /display/{fichier}` : renvoie un JSON pre-rendu (ex. `global_stats.json`).
- `GET /data/{dossier}/{fichier}` : expose un CSV sous forme JSON ou un GeoJSON venant de `display-data/`, `data_clean/`, `outputs/` ou `data_raw/`.

Fichiers exposés
----------------
- `display-data/` : `global_stats.json`, `anomalies_tabulaire.json`, `surfaces_distribution.json`, `top_producteurs_anomalies.json`, `anomalies_par_coop.json`, `chevauchements_summary.json`, `report_metadata.json`.
  Ajouts analytiques (`script_11_export_display_data.py`) : `anomalies_surface.json`, `doublons_producteurs.json`, `doublons_parcelles.json`, `chevauchements_parcelles.json`, `resume_anomalies.json`.
  Audit nettoyage (`script_13_data_cleaning_audit.py`) : `data_cleaning_audit.json`.
  Autres fichiers produits par les scripts metiers : `meta_script_9.json`, `synthese_coherence_coop.json`, `synthese_coherence_producteurs.json`, etc.
- `data_clean/` : jeux nettoyes (CSV/GeoJSON) accessibles via `/data/clean/{fichier}`.
- `outputs/` : artefacts produits par les scripts (CSV/GeoJSON) accessibles via `/data/outputs/{chemin}`.
- `data_raw/` : fichiers sources bruts accessibles via `/data/raw/{fichier}` (ex. `parcelles.geojson`).

Exemples d'appels
-----------------
```text
GET http://localhost:8000/display/global_stats.json
GET http://localhost:8000/data/clean/coop_producteurs_clean.csv
GET http://localhost:8000/data/outputs/script_8b/csv_only_correspondances_base_id.csv
GET http://localhost:8000/status
```

Journalisation
--------------
Chaque requête est tracée dans `logs/api_requests.log` (méthode, endpoint, code HTTP, durée), ce qui facilite l’audit des échanges avec le dashboard.

Notes
-----
- Les CSV sont convertis en JSON (`application/json`) pour simplifier la consommation côté Next.js.
- Les fichiers GeoJSON/JSON sont renvoyés tels quels avec un objet de métadonnées (taille, timestamp, colonnes).
- L’API s’appuie sur Pandas et GeoPandas pour la lecture des fichiers ; assurez-vous que les dépendances système de GeoPandas sont disponibles (GDAL/PROJ). Sur macOS : `brew install gdal proj sqlite3`.
